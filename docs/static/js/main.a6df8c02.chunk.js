(this["webpackJsonpspace-sim"]=this["webpackJsonpspace-sim"]||[]).push([[0],{119:function(e){e.exports=JSON.parse('[{"url":"localhost:3979","secure":false},{"url":"derpy.live:3979","secure":false},{"url":"ssserver.flynna.uk","secure":true},{"url":"s1.ss.flynna.uk","secure":false},{"url":"[2a04:92c7:16:335:bf1f:42bc:b67b:565]","secure":false}]')},120:function(e,t,n){e.exports=n(329)},125:function(e,t,n){},126:function(e,t,n){},156:function(e,t){},159:function(e,t,n){},160:function(e,t,n){},325:function(e,t,n){},327:function(e,t,n){},328:function(e,t,n){},329:function(e,t,n){"use strict";n.r(t);var a=n(0),l=n.n(a),i=n(9),o=n.n(i),c=(n(125),n(19)),r=(n(126),n(116)),s=n.n(r),u=n(11),d=n(12),h=n(20),m=n(18),y=(n(159),{intervals:{},socket:null,server:null,root:document.getElementById("root")}),p={open:"+Chat",close:"-Chat"};function f(){return"block"==document.getElementById("chatBox").style.display}function v(){var e=f();document.getElementById("chatBox").style.display=e?"none":"block",document.getElementById("openChatButtonText").innerHTML=p[e?"open":"close"]}var E=function(){var e=document.getElementById("chatInput");""!=e.value&&(y.socket.emit("sendMessage",e.value),e.value="")};n(160);var g=function(){null!=y.socket&&(P.unregister(),y.socket.removeAllListeners(),y.socket.close(),y.socket=null,clearInterval(y.intervals.colliding),clearInterval(y.intervals.draw),o.a.render(Q(),y.root))},k=n(117),b=(n(325),function(e){Object(h.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,l=new Array(a),i=0;i<a;i++)l[i]=arguments[i];return(e=t.call.apply(t,[this].concat(l))).state={background:"#000000"},e.handleClick=function(){e.setState({displayColorPicker:!e.state.displayColorPicker})},e.handleChangeComplete=function(e){y.socket.emit("changeColor",e.hex)},e.colors=["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50"],e}return Object(d.a)(n,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("button",{onClick:this.handleClick},"Toggle ship color picker"),this.state.displayColorPicker?l.a.createElement(k.SketchPicker,{width:"130px",disableAlpha:!0,presetColors:this.colors,onChangeComplete:this.handleChangeComplete}):null)}}]),n}(l.a.Component));function x(){document.getElementById("pauseMenu").style.display="block",document.getElementById("pauseButton").style.display="none"}function w(){document.getElementById("pauseMenu").style.display="none",document.getElementById("pauseButton").style.display="block"}function I(){w(),g(),setTimeout((function(){return X(y.server)}),1)}var C=function(){return l.a.createElement("div",null,l.a.createElement("button",{id:"pauseButton",onClick:x,style:{display:"block"}}),l.a.createElement("div",{id:"pauseMenu",style:{display:"none"}},l.a.createElement("center",{id:"pauseMenuContents"},l.a.createElement("button",{onClick:w},"Resume"),l.a.createElement("br",null),l.a.createElement("button",{onClick:I},"New ship"),l.a.createElement("br",null),l.a.createElement("button",{onClick:g},"Disconnect"),l.a.createElement("br",null),l.a.createElement(b,null),l.a.createElement("hr",null),l.a.createElement("p",null,"Server: ",y.server.url,l.a.createElement("br",null),"Ping: ",l.a.createElement("span",{id:"ping"},"(pinging...)"),"ms",l.a.createElement("br",null),"FPS: ",l.a.createElement("span",{id:"FPSDisplay"},"(waiting for frame...)")))))},M={ArrowUp:3,ArrowRight:0,ArrowDown:2,ArrowLeft:1};function B(e){"chatInput"!=document.activeElement.id&&("Space"==e.code?y.socket.emit("nuke"):M.hasOwnProperty(e.code)&&(e.preventDefault(),y.socket.emit("dir",M[e.code],!0)))}function V(e){switch(e.code){case"KeyT":f()||v(),"chatInput"!=document.activeElement.id&&document.getElementById("chatInput").focus();break;case"Enter":"chatInput"==document.activeElement.id&&E();break;case"Escape":"chatInput"==document.activeElement.id&&f()?v():"block"==document.getElementById("pauseMenu").style.display?w():x();break;default:M.hasOwnProperty(e.code)&&(e.preventDefault(),y.socket.emit("dir",M[e.code],!1))}}function L(e){y.c.width=document.documentElement.clientWidth,y.c.height=document.documentElement.clientHeight}var P=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,null,[{key:"register",value:function(){window.addEventListener("keydown",B),window.addEventListener("keyup",V),L(),window.addEventListener("resize",L)}},{key:"unregister",value:function(){window.removeEventListener("keydown",B),window.removeEventListener("keyup",V),window.removeEventListener("resize",L)}}]),e}(),S=n(118);n(327);function O(e){return l.a.createElement("div",{className:"chat-message"},l.a.createElement("svg",{className:"player-icon",height:16,width:16},l.a.createElement("circle",{cx:8,cy:8,r:8,fill:e.player.color})),l.a.createElement("span",{className:"chat-message-text"},e.children))}var T=function(e){Object(h.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(u.a)(this,n);for(var a=arguments.length,l=new Array(a),i=0;i<a;i++)l[i]=arguments[i];return(e=t.call.apply(t,[this].concat(l))).state={messages:[]},e}return Object(d.a)(n,[{key:"render",value:function(){return l.a.createElement("div",{id:"chat"},l.a.createElement("button",{id:"openChatButton",onClick:v},l.a.createElement("span",{id:"openChatButtonText"},p.open),"(",l.a.createElement("span",{id:"messagesSentNum"},"0"),")"),l.a.createElement("div",{id:"chatBox"},l.a.createElement("div",{id:"chatMessages"},this.state.messages),l.a.createElement("div",{id:"sendChat"},l.a.createElement("input",{id:"chatInput",maxLength:100}),l.a.createElement("button",{onClick:E},"Send"))))}}]),n}(l.a.Component);var j,F,z,H,D,A,N=function(){y.socket.on("message",(function(e,t){var n=document.getElementById("chatMessages");n.innerHTML+=Object(S.renderToString)(l.a.createElement(O,{player:e},t));var a=document.getElementById("chatMessages").children,i=a[a.length-1],o=n.scrollHeight-n.clientHeight-n.clientTop;o-n.scrollTop<i.clientHeight+5&&(n.scrollTop=o),document.getElementById("messagesSentNum").innerHTML=a.length}))},q=!1;function R(e){var t=3;e.deltaY<0&&(t*=-1);var n=1+t/100;D*n>0&&(D*=n,A.x/=n,A.y/=n)}function J(e){q&&(A.x+=e.movementX,A.y+=e.movementY)}function W(e,t,n){var a=n/2;F.fillRect(e-a+A.x,t-a+A.y,n,n)}var K=function(){var e=document.getElementById("mainCanvas");y.c=e;var t=e.getContext("2d"),n=0,a=[],l=[],i=Date.now();function o(e,t){return Math.abs(Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)))}var r=function(){function e(t,n){Object(u.a)(this,e),this.x=t,this.y=n,this.xVel=0,this.yVel=0,this.bouncyness=.5,this.mass=10,this.size=10,this.color="#FFFFFF",this.collided=!1,this.delete=!1,this.path=[],this.pathMax=100,this.pathColor="#0000FF",this.invincible=!1,this.colliding=!1}return Object(d.a)(e,[{key:"collide",value:function(e){var t=this.mass+e.mass,n=this.mass/t,a=e.mass/t;this.xVel=(this.xVel*n+e.xVel*a)/2,this.yVel=(this.yVel*n+e.yVel*a)/2,this.mass+=e.mass}},{key:"move",value:function(){this.y+=this.yVel,this.x+=this.xVel,this.yVel+=0,this.delete}},{key:"update",value:function(){if(!this.delete){this.colliding=!1;for(var e=0;e<l.length;e++)if(l[e].x!=this.x&&l[e].y!=this.y)if(o(l[e],this)<this.size/2+l[e].size/2&&!this.collided)this.colliding=!0,this.mass>l[e].mass||this.mass==l[e].mass?l[e].invincible||(this.collide(l[e]),l[e].delete=!0,l[e].collided=!0,this.collided=!0):this.invincible&&(this.xVel=l[e].xVel,this.yVel=l[e].yVel);else{this.mass,l[e].mass;var t=o(this,l[e]),n=l[e].mass/(t*t)*.00667,a=Math.abs(this.x-l[e].x),i=Math.abs(this.y-l[e].y),c=a+i;this.x<l[e].x?this.xVel+=n*(a/c):this.xVel+=n*(-1*a/c),this.y<l[e].y?this.yVel+=n*(i/c):this.yVel+=n*(-1*i/c)}this.collided=!1}}}]),e}(),s=[!1,!1,!1,!1];function h(e){e.size=Math.sqrt(e.mass/e.density/Math.PI),e.path.push([e.x,e.y]),t.strokeStyle=e.pathColor,t.moveTo(e.path[0][0]-k,e.path[0][1]-b);for(var n=0;n<e.path.length;n++)t.lineTo(e.path[n][0]-k,e.path[n][1]-b);t.stroke(),e.path.length>e.pathMax&&e.path.splice(0,1);if(e.mass>500)for(var a=0;a<20;a++){var l=e.color;l=l.replace(")",",0.05)").replace("rgb(","rgba("),t.fillStyle=l,t.strokeStyle=l,t.beginPath(),t.arc(e.x+0-k,e.y+0-b,e.size/2+a*(e.size/500)*50,0,2*Math.PI),t.fill(),t.stroke()}t.fillStyle=e.color,t.strokeStyle=e.color,null==e.shipId?(t.beginPath(),t.arc(e.x+0-k,e.y+0-b,e.size/2,0,2*Math.PI),t.fill(),t.stroke()):(t.beginPath(),t.arc(e.x+0-k,e.y+0-b,4*e.size,0,2*Math.PI),t.fill(),t.stroke()),t.shadowBlur=0,t.fillStyle="#FF0000",t.strokeStyle="#FF0000",t.beginPath(),t.moveTo(e.x-k,e.y-b);t.lineTo(20*e.xVel+e.x-k,20*e.yVel+e.y-b),t.stroke(),e.nuke&&(t.fillStyle="#FFFF00",t.fillText("*",e.x,e.y))}P.register(),y.intervals.colliding=setInterval((function(){s[0]&&(l[0].xVel+=.01,l[0].colliding&&(l[0].x+=1)),s[1]&&(l[0].xVel-=.01,l[0].colliding&&(l[0].x-=1)),s[2]&&(l[0].yVel+=.01,l[0].colliding&&(l[0].y+=1)),s[3]&&(l[0].yVel-=.01,l[0].colliding&&(l[0].y-=1))}),50);for(var m=[],p=0;p<m.length;p++)for(var f=0;f<m[p].swarmSize;f++){var v=2*Math.PI/m[p].swarmSize*f+m[p].off,E=new r(Math.cos(v)*m[p].d+m[p].centerx,Math.sin(v)*m[p].d+m[p].centery);E.xVel=Math.cos(v+Math.PI/2)*m[p].vel,E.yVel=Math.sin(v+Math.PI/2)*m[p].vel,E.size=m[p].m/10,E.mass=m[p].m,l.push(E)}var k=0,b=0;y.intervals.draw=setInterval((function(){for(var o in l.length>0&&(k=l[n].x-e.width/2,b=l[n].y-e.height/2),a=[],l)o!=n&&null!=l[o].shipId&&a.push(o);t.fillStyle="#000000",t.fillRect(0,0,e.width,e.height);var r,s=Object(c.a)(l);try{for(s.s();!(r=s.n()).done;){h(r.value)}}catch(d){s.e(d)}finally{s.f()}if(function(e,t){if(F.clearRect(0,0,j.width,j.height),e[t]){var n,a=e[t],l=Object(c.a)(e);try{for(l.s();!(n=l.n()).done;){var i=n.value,o=i.mass>500;if(o||i.shipId){F.fillStyle=i.color;var r=0;o&&(r=i.size/10*(100/D));var s=(i.x-a.x)/D,u=(i.y-a.y)/D;W(z+s,H+u,o?r:4)}}}catch(d){l.e(d)}finally{l.f()}F.fillStyle=a.color,W(z,H,5)}}(l,n),null!=l[n]){var u=Date.now();document.getElementById("speedspan").innerHTML=Math.round(100*Math.sqrt(l[n].yVel*l[n].yVel+l[n].xVel*l[n].xVel))/100,document.getElementById("xcoord").innerHTML=Math.round(l[n].x),document.getElementById("ycoord").innerHTML=Math.round(l[n].y),document.getElementById("playersOnline").innerHTML=a.length+1,document.getElementById("FPSDisplay").innerHTML=Math.round(1e3/(u-i)),i=u}}),50);var x=0;y.socket.on("connect",(function(){x=y.socket.id})),y.socket.on("pong",(function(e){document.getElementById("ping").innerHTML=e})),y.socket.on("kick",(function(e){setTimeout((function(){g(),alert(e)}),500)})),y.socket.on("disconnect",(function(){setTimeout((function(){g(),alert("Communication between you and the server was interrupted.")}),500)})),y.socket.on("bodyupdate",(function(e){l=JSON.parse(e);var t=!1;for(var a in l){if(null!=l[a].shipId)l[a].shipId==x&&(n=a,t=!0)}t||(n=0,y.socket.emit("newShip"))})),y.socket.on("center",(function(e){n=e})),N()};n(328);var U=function(){return l.a.createElement("canvas",{id:"map",width:150,height:150})},Y=function(e){Object(h.a)(n,e);var t=Object(m.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("canvas",{id:"mainCanvas"}),l.a.createElement("div",{id:"info"},"velocity: ",l.a.createElement("span",{id:"speedspan"}),"km/s",l.a.createElement("br",null),"x: ",l.a.createElement("span",{id:"xcoord"})," y: ",l.a.createElement("span",{id:"ycoord"}),l.a.createElement("br",null),"players online: ",l.a.createElement("span",{id:"playersOnline"})),l.a.createElement(C,null),l.a.createElement(U,null),l.a.createElement(T,null))}},{key:"componentDidMount",value:function(){j=document.getElementById("map"),F=j.getContext("2d"),j.requestPointerLock=j.requestPointerLock||j.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,j.addEventListener("wheel",R),j.addEventListener("mousemove",J),j.addEventListener("mousedown",(function(){q=!0,j.requestPointerLock()})),j.addEventListener("mouseup",(function(){q=!1,document.exitPointerLock()})),z=j.width/2,H=j.height/2,D=100,A={x:0,y:0},K()}}]),n}(l.a.Component);var X=function(e){y.socket=s()("ws".concat(e.secure?"s":"","://").concat(e.url),{transports:["websocket"]}),y.server=e,y.socket.on("reconnect_attempt",(function(){y.socket.io.opts.transports=["polling","websocket"]})),o.a.render(l.a.createElement(Y,null),y.root)},_=n(119);function G(){var e=document.getElementById("toConnect").value,t={url:e,secure:!1};e.startsWith("http://")?t.url=e.slice("http://".length):e.startsWith("https://")&&(t.url=e.slice("https://".length),t.secure=!0),X(t)}var Q=function(){null!=y.socket&&(y.socket.close(),y.socket=null);var e,t=[],n="https:"==window.location.protocol,a=Object(c.a)(_);try{var i=function(){var a=e.value;if(n&&!a.secure)return"continue";t.push(l.a.createElement("div",null,l.a.createElement("button",{onClick:function(){return X(a)}},a.url)))};for(a.s();!(e=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return l.a.createElement("div",null,t,l.a.createElement("br",null),l.a.createElement("label",null,"Direct connect:"),l.a.createElement("br",null),l.a.createElement("input",{id:"toConnect",placeholder:"IP/Address",onKeyUp:function(e){"Enter"===e.key&&G()}}),l.a.createElement("button",{onClick:G},"Connect"))};o.a.render(Q(),y.root)}},[[120,1,2]]]);
//# sourceMappingURL=main.a6df8c02.chunk.js.map